generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id         String   @id @default(uuid())
  email      String   @unique
  name       String?
  created_at DateTime @default(now())
  role       String?
}

model Ad {
  id              String   @id @default(uuid())
  user_email      String
  business_name   String?
  destination_url String?
  title           String?
  Description     String?
  Tags            String[]
  keywords        String[]
  wallet_address  String?
  cost_per_click  Decimal? @db.Decimal(18, 9)
  Weekly_Clicks   Int?
  Weekly_Cost     Decimal? @db.Decimal(18, 9)
  imageUrl        String?
  created_at      DateTime @default(now())
  updated_at      DateTime  @default(now()) @updatedAt

  impressions Impression[]
  clicks      Click[]
}

model new_website {
  id             String   @id @default(uuid())
  email          String?  
  website_name   String?
  website_url    String?  @unique
  Tags           String[]
  keywords       String[]
  wallet_address String?
  status         String? @default("Review")
  created_at     DateTime @default(now())
  updated_at     DateTime  @default(now()) @updatedAt

  impressions Impression[]
  clicks      Click[]
}

model Impression {
  id          String   @id @default(uuid())
  ad_id       String
  website_url  String
  match_score Decimal? @db.Decimal(5, 2)
  user_ip     String?
  user_agent  String?
  created_at  DateTime @default(now())
  
  ad      Ad          @relation(fields: [ad_id], references: [id])
  website new_website @relation(fields: [website_url], references: [id])

  @@index([ad_id, created_at])
  @@index([website_url, created_at])
  @@index([created_at])
}

model Click {
  id            String   @id @default(uuid())
  ad_id         String
  website_url   String
  impression_id String?
  user_ip       String?
  user_agent    String?
  created_at    DateTime @default(now())

  ad      Ad          @relation(fields: [ad_id], references: [id])
  website new_website @relation(fields: [website_url], references: [id])

  @@index([ad_id, created_at])
  @@index([website_url, created_at])
  @@index([created_at])
}
